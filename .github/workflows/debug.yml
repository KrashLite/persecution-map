name: Debug Data Update

on:
  workflow_dispatch:

jobs:
  debug:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '18'
      
      - run: npm install
      
      - name: Test News API
        env:
          NEWS_API_KEY: ${{ secrets.NEWS_API_KEY }}
        run: |
          echo "=== ТЕСТ API ==="
          node -e "
            const https = require('https');
            const key = process.env.NEWS_API_KEY;
            console.log('Key exists:', !!key);
            console.log('Key length:', key?.length);
            
            const url = \`https://newsapi.org/v2/everything?q=christian+nigeria&pageSize=1&apiKey=\${key}\`;
            https.get(url, (res) => {
              let data = '';
              res.on('data', chunk => data += chunk);
              res.on('end', () => {
                const json = JSON.parse(data);
                console.log('Status:', json.status);
                console.log('Total results:', json.totalResults);
                if (json.articles) {
                  console.log('Sample article:', json.articles[0]?.title);
                }
              });
            });
          "
      
      - name: Run full update
        env:
          NEWS_API_KEY: ${{ secrets.NEWS_API_KEY }}
        run: node news-api.js
      
      - name: Check result
        run: |
          echo "=== РЕЗУЛЬТАТ ==="
          ls -la data/
          cat data/events.json | head -100
