<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <title>–ö–∞—Ä—Ç–∞ –ø—Ä–µ—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π —Ö—Ä–∏—Å—Ç–∏–∞–Ω 2026</title>
    <!-- ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ meta ... -->
    
    <style>
        /* ... –≤–∞—à–∏ —Å—Ç–∏–ª–∏ ... */
        
        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ */
        .loading-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(15, 15, 30, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s;
        }
        .loading-overlay.hidden { opacity: 0; pointer-events: none; }
        .spinner {
            width: 50px; height: 50px;
            border: 3px solid rgba(255, 107, 107, 0.3);
            border-top-color: #ff6b6b;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { margin-top: 20px; color: #feca57; }
    </style>
</head>
<body>
    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div class="loading-overlay" id="loader">
        <div class="spinner"></div>
        <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
    </div>

    <!-- ... –≤–∞—à splash screen ... -->
    
    <!-- ... –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å ... -->

    <script>
        const CONFIG = {
            // –ö–†–ò–¢–ò–ß–ù–û: –¥–æ–±–∞–≤–ª—è–µ–º timestamp —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∫—ç—à–∞
            dataUrl: 'data/events.json?v=' + Date.now(),
            colors: {
                murder: '#c0392b', 
                attack: '#e74c3c', 
                kidnapping: '#f39c12',
                arrest: '#8e44ad', 
                discrimination: '#3498db', 
                other: '#95a5a6'
            },
            typeLabels: {
                murder: '–£–±–∏–π—Å—Ç–≤–∞',
                attack: '–ê—Ç–∞–∫–∏',
                kidnapping: '–ü–æ—Ö–∏—â–µ–Ω–∏—è',
                arrest: '–ê—Ä–µ—Å—Ç—ã',
                discrimination: '–î–∏—Å–∫—Ä–∏–º–∏–Ω–∞—Ü–∏—è',
                other: '–î—Ä—É–≥–æ–µ'
            }
        };

        let map, markers = [], allEvents = [];
        let appInitialized = false;

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏
        async function loadDataWithRetry(retries = 3) {
            for (let i = 0; i < retries; i++) {
                try {
                    console.log(`üì° –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ${i + 1}/${retries}...`);
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –æ–±—Ö–æ–¥–∞ –∫—ç—à–∞
                    const url = CONFIG.dataUrl + '&r=' + Math.random();
                    
                    const response = await fetch(url, {
                        cache: 'no-store',
                        headers: {
                            'Cache-Control': 'no-cache',
                            'Pragma': 'no-cache'
                        }
                    });
                    
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    
                    const data = await response.json();
                    console.log('üì¶ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã:', data);
                    console.log('üìä –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ:', data.metadata);
                    console.log('üìà –°–æ–±—ã—Ç–∏–π:', data.events?.length || 0);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É
                    if (!data.events || !Array.isArray(data.events)) {
                        throw new Error('–ù–µ–≤–µ—Ä–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö');
                    }
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ—Å–ª–µ–¥–Ω–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
                    if (data.metadata?.lastUpdated) {
                        const updateDate = new Date(data.metadata.lastUpdated);
                        console.log('üïê –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:', updateDate.toLocaleString('ru-RU'));
                        
                        // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ä—à–µ 2 –¥–Ω–µ–π
                        const daysDiff = (new Date() - updateDate) / (1000 * 60 * 60 * 24);
                        if (daysDiff > 2) {
                            console.warn('‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ —É—Å—Ç–∞—Ä–µ–ª–∏ –±–æ–ª–µ–µ —á–µ–º –Ω–∞ 2 –¥–Ω—è!');
                        }
                    }
                    
                    return data.events;
                    
                } catch (error) {
                    console.error(`‚ùå –ü–æ–ø—ã—Ç–∫–∞ ${i + 1} –Ω–µ —É–¥–∞–ª–∞—Å—å:`, error);
                    if (i === retries - 1) throw error;
                    await new Promise(r => setTimeout(r, 1000 * (i + 1))); // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∑–∞–¥–µ—Ä–∂–∫—É
                }
            }
        }

        async function init() {
            initMap();
            
            try {
                allEvents = await loadDataWithRetry();
                document.getElementById('loader').classList.add('hidden');
                renderEvents(allEvents);
                updateStats(allEvents);
            } catch (error) {
                console.error('üí• –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ:', error);
                document.querySelector('.loading-text').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏. –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ...';
                
                // Fallback –Ω–∞ —Å–ª—É—á–∞–π –ø–æ–ª–Ω–æ–π –æ—à–∏–±–∫–∏
                setTimeout(() => {
                    allEvents = getHardcodedFallback();
                    document.getElementById('loader').classList.add('hidden');
                    renderEvents(allEvents);
                    updateStats(allEvents);
                }, 1500);
            }
        }

        function getHardcodedFallback() {
            const today = new Date();
            return [
                {
                    date: today.toISOString().split('T')[0],
                    lat: 9.0810, lng: 7.4895,
                    country: "–ù–∏–≥–µ—Ä–∏—è", city: "–ê–±—É–¥–∂–∞",
                    type: "attack",
                    title: "‚ö†Ô∏è –¢–µ—Å—Ç: –ù–∞–ø–∞–¥–µ–Ω–∏–µ –Ω–∞ —Ü–µ—Ä–∫–æ–≤—å (–¥–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã)",
                    description: "–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å (F12) –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.",
                    source: "Emergency Fallback",
                    victims: 5
                }
            ];
        }

        // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ renderEvents, filterEvents –∏ —Ç.–¥. ...
        
        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        setInterval(() => {
            console.log('üîÑ –ê–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π...');
            loadDataWithRetry(1).then(newEvents => {
                if (newEvents.length !== allEvents.length) {
                    console.log('üì° –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ, –æ–±–Ω–æ–≤–ª—è–µ–º...');
                    allEvents = newEvents;
                    renderEvents(allEvents);
                    updateStats(allEvents);
                }
            }).catch(() => {});
        }, 300000); // 5 –º–∏–Ω—É—Ç
    </script>
</body>
</html>
