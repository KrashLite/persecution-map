<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    
    <title>–ö–∞—Ä—Ç–∞ –ø—Ä–µ—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π —Ö—Ä–∏—Å—Ç–∏–∞–Ω 2026</title>
    <meta name="description" content="–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ –ø—Ä–µ—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π —Ö—Ä–∏—Å—Ç–∏–∞–Ω –≤ –º–∏—Ä–µ">
    
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Crimson Text', serif;
            background: #0f0f1e;
            color: #eaeaea;
            overflow: hidden;
        }

        /* –°–¢–ê–†–¢–û–í–´–ô –≠–ö–†–ê–ù */
        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e 0%, #0f0f1e 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.8s ease, visibility 0.8s ease;
        }

        #splash-screen.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .splash-logo-container {
            position: relative;
            width: 300px;
            height: 300px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .splash-logo-container:hover {
            transform: scale(1.05);
        }

        .splash-logo-gif,
        .splash-logo-png {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 4px solid rgba(255, 107, 107, 0.3);
            box-shadow: 0 0 60px rgba(255, 107, 107, 0.4);
            object-fit: cover;
            transition: opacity 0.5s ease;
        }

        .splash-logo-gif {
            opacity: 1;
            z-index: 2;
        }

        .splash-logo-gif.finished {
            opacity: 0;
            pointer-events: none;
        }

        .splash-logo-png {
            opacity: 0;
            z-index: 1;
        }

        .splash-logo-png.visible {
            opacity: 1;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 60px rgba(255, 107, 107, 0.4), 0 0 100px rgba(255, 107, 107, 0.2); }
            50% { box-shadow: 0 0 80px rgba(255, 107, 107, 0.6), 0 0 140px rgba(255, 107, 107, 0.3); }
        }

        .splash-logo-container {
            animation: pulse 2s infinite;
        }

        .splash-text {
            margin-top: 40px;
            font-size: 2rem;
            color: #feca57;
            text-align: center;
            text-shadow: 0 0 20px rgba(254, 202, 87, 0.3);
        }

        .splash-subtext {
            margin-top: 15px;
            font-size: 1.2rem;
            color: #888;
            text-align: center;
        }

        .splash-hint {
            margin-top: 30px;
            font-size: 1rem;
            color: #ff6b6b;
            animation: blink 1.5s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* –û–°–ù–û–í–ù–û–ô –ò–ù–¢–ï–†–§–ï–ô–° */
        #main-app {
            opacity: 0;
            transition: opacity 0.5s ease;
            height: 100vh;
        }

        #main-app.visible {
            opacity: 1;
        }

        /* –ò–ù–î–ò–ö–ê–¢–û–† –ó–ê–ì–†–£–ó–ö–ò –î–ê–ù–ù–´–• */
        #data-loader {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 15, 30, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s;
        }

        #data-loader.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 107, 107, 0.2);
            border-top-color: #ff6b6b;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loader-text {
            margin-top: 20px;
            color: #feca57;
            font-size: 1.2rem;
        }

        .loader-error {
            margin-top: 15px;
            color: #ff6b6b;
            font-size: 1rem;
            max-width: 400px;
            text-align: center;
            padding: 0 20px;
        }

        /* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-img {
            height: 50px;
            width: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid rgba(255, 107, 107, 0.5);
            box-shadow: 0 0 15px rgba(255, 107, 107, 0.3);
        }

        .header {
            position: absolute;
            top: 0;
            left: 350px;
            right: 0;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(10px);
            padding: 10px 30px;
            z-index: 1000;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 80px;
        }

        .site-title {
            font-size: 1.5rem;
            background: linear-gradient(135deg, #ff6b6b, #feca57);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
        }

        .stats {
            display: flex;
            gap: 15px;
        }

        .stat {
            text-align: center;
            padding: 8px 12px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
            min-width: 80px;
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: #ff6b6b;
        }

        .stat-label {
            font-size: 0.65rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .sidebar {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 350px;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(10px);
            z-index: 1001;
            overflow-y: auto;
            border-right: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar-title {
            font-size: 1.3rem;
            color: #feca57;
            margin-bottom: 5px;
        }

        .sidebar-subtitle {
            font-size: 0.85rem;
            color: #888;
        }

        .filter-section {
            padding: 20px;
        }

        .filter-title {
            font-size: 0.75rem;
            text-transform: uppercase;
            color: #888;
            margin-bottom: 15px;
            letter-spacing: 1px;
        }

        .filter-btn {
            padding: 8px 16px;
            margin: 4px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.05);
            color: #ccc;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85rem;
            font-family: inherit;
        }

        .filter-btn:hover, .filter-btn.active {
            background: #ff6b6b;
            border-color: #ff6b6b;
            color: white;
        }

        .events-list {
            padding: 0 20px 20px;
        }

        .event-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid var(--color, #666);
        }

        .event-card:hover {
            background: rgba(255,255,255,0.08);
            transform: translateX(5px);
        }

        .event-date { font-size: 0.75rem; color: #888; margin-bottom: 5px; }
        .event-title { font-size: 1.1rem; margin-bottom: 5px; color: #fff; }
        .event-location { font-size: 0.85rem; color: #aaa; }

        #map {
            height: 100vh;
            width: 100%;
            background: #0f0f1e;
        }

        .leaflet-control-zoom {
            position: fixed !important;
            bottom: 30px !important;
            right: 30px !important;
            top: auto !important;
            left: auto !important;
        }

        .legend {
            position: absolute;
            bottom: 100px;
            right: 30px;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 10px;
            z-index: 999;
        }

        .legend h4 {
            margin-bottom: 10px;
            color: #feca57;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 6px 0;
            font-size: 0.85rem;
        }

        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        @media (max-width: 768px) {
            .splash-logo-container { width: 200px; height: 200px; }
            .splash-text { font-size: 1.5rem; }
            .sidebar { width: 100%; top: auto; bottom: 0; height: 40vh; }
            .header { left: 0; height: auto; padding: 10px; flex-wrap: wrap; }
            .logo-img { height: 40px; width: 40px; }
            .stats { gap: 8px; }
            .stat { padding: 6px 8px; min-width: 70px; }
            .stat-value { font-size: 1.1rem; }
            .stat-label { font-size: 0.6rem; }
        }
    </style>
</head>
<body>
    <!-- –ò–ù–î–ò–ö–ê–¢–û–† –ó–ê–ì–†–£–ó–ö–ò -->
    <div id="data-loader">
        <div class="spinner"></div>
        <div class="loader-text">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
        <div class="loader-error" id="loader-error" style="display: none;"></div>
    </div>

    <!-- –°–¢–ê–†–¢–û–í–´–ô –≠–ö–†–ê–ù -->
    <div id="splash-screen">
        <div class="splash-logo-container" onclick="enterSite()">
            <img src="images/logo-animated.gif" alt="Logo" class="splash-logo-gif" id="splash-gif">
            <img src="images/logo.png" alt="Logo" class="splash-logo-png" id="splash-png">
        </div>
        <div class="splash-text">–ö–∞—Ä—Ç–∞ –ø—Ä–µ—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π —Ö—Ä–∏—Å—Ç–∏–∞–Ω</div>
        <div class="splash-subtext">–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –≥–æ–Ω–µ–Ω–∏—è—Ö –Ω–∞ —Ö—Ä–∏—Å—Ç–∏–∞–Ω –ø–æ –≤—Å–µ–º—É –º–∏—Ä—É</div>
        <div class="splash-hint">‚Üñ –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ª–æ–≥–æ—Ç–∏–ø —á—Ç–æ–±—ã –≤–æ–π—Ç–∏</div>
    </div>

    <!-- –û–°–ù–û–í–ù–û–ô –ò–ù–¢–ï–†–§–ï–ô–° -->
    <div id="main-app">
        <div class="header">
            <div class="logo-container">
                <img src="images/logo.png" alt="Logo" class="logo-img">
                <div class="site-title">–ö–∞—Ä—Ç–∞ –ø—Ä–µ—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π —Ö—Ä–∏—Å—Ç–∏–∞–Ω</div>
            </div>
            
            <div class="stats">
                <div class="stat">
                    <div class="stat-value" id="total-events">0</div>
                    <div class="stat-label">–ù–∞ –∫–∞—Ä—Ç–µ</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="total-countries">0</div>
                    <div class="stat-label">–°—Ç—Ä–∞–Ω</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="total-victims">0</div>
                    <div class="stat-label">–ñ–µ—Ä—Ç–≤</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="archived-total">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –∑–∞ –≥–æ–¥</div>
                </div>
            </div>
        </div>

        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">–§–∏–ª—å—Ç—Ä—ã</div>
                <div class="sidebar-subtitle">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞</div>
            </div>
            
            <div class="filter-section">
                <div class="filter-title">–¢–∏–ø –ø—Ä–µ—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è</div>
                <div id="filter-buttons">
                    <button class="filter-btn active" onclick="filterEvents('all')">–í—Å–µ</button>
                    <button class="filter-btn" onclick="filterEvents('murder')">–£–±–∏–π—Å—Ç–≤–∞</button>
                    <button class="filter-btn" onclick="filterEvents('attack')">–ê—Ç–∞–∫–∏</button>
                    <button class="filter-btn" onclick="filterEvents('kidnapping')">–ü–æ—Ö–∏—â–µ–Ω–∏—è</button>
                    <button class="filter-btn" onclick="filterEvents('arrest')">–ê—Ä–µ—Å—Ç—ã</button>
                    <button class="filter-btn" onclick="filterEvents('discrimination')">–î–∏—Å–∫—Ä–∏–º–∏–Ω–∞—Ü–∏—è</button>
                </div>
            </div>
            
            <div class="filter-title" style="padding: 0 20px;">–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è</div>
            <div class="events-list" id="events-list"></div>
        </div>

        <div id="map"></div>

        <div class="legend">
            <h4>–õ–µ–≥–µ–Ω–¥–∞</h4>
            <div class="legend-item"><div class="dot" style="background: #c0392b;"></div>–£–±–∏–π—Å—Ç–≤–∞</div>
            <div class="legend-item"><div class="dot" style="background: #e74c3c;"></div>–ê—Ç–∞–∫–∏</div>
            <div class="legend-item"><div class="dot" style="background: #f39c12;"></div>–ü–æ—Ö–∏—â–µ–Ω–∏—è</div>
            <div class="legend-item"><div class="dot" style="background: #8e44ad;"></div>–ê—Ä–µ—Å—Ç—ã</div>
            <div class="legend-item"><div class="dot" style="background: #3498db;"></div>–î–∏—Å–∫—Ä–∏–º–∏–Ω–∞—Ü–∏—è</div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const CONFIG = {
            dataUrl: 'data/events.json?v=' + Date.now(),
            archiveUrl: 'data/events-archive.json?v=' + Date.now(),
            colors: {
                murder: '#c0392b',
                attack: '#e74c3c',
                kidnapping: '#f39c12',
                arrest: '#8e44ad',
                discrimination: '#3498db',
                other: '#95a5a6'
            },
            typeLabels: {
                murder: '–£–±–∏–π—Å—Ç–≤–∞',
                attack: '–ê—Ç–∞–∫–∏',
                kidnapping: '–ü–æ—Ö–∏—â–µ–Ω–∏—è',
                arrest: '–ê—Ä–µ—Å—Ç—ã',
                discrimination: '–î–∏—Å–∫—Ä–∏–º–∏–Ω–∞—Ü–∏—è',
                other: '–î—Ä—É–≥–æ–µ'
            }
        };

        let map, markers = [], allEvents = [];
        let dataLoaded = false;
        let mapInitialized = false;
        let archivedTotal = 0;

        // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è —Å–º–µ–Ω—ã GIF –Ω–∞ PNG
        window.addEventListener('load', () => {
            setTimeout(() => {
                const gif = document.getElementById('splash-gif');
                const png = document.getElementById('splash-png');
                gif.classList.add('finished');
                png.classList.add('visible');
            }, 5800);
            
            // –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö –°–†–ê–ó–£
            console.log('üöÄ –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö...');
            initMap();
            loadData();
        });

        function initMap() {
            if (mapInitialized) return;
            
            map = L.map('map', {
                center: [20, 0],
                zoom: 2,
                minZoom: 2,
                maxZoom: 18,
                zoomControl: false
            });
            
            L.control.zoom({ position: 'bottomright' }).addTo(map);
            
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; CARTO',
                subdomains: 'abcd',
                maxZoom: 20
            }).addTo(map);
            
            mapInitialized = true;
            console.log('‚úÖ –ö–∞—Ä—Ç–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
        }

        async function loadData() {
            const loader = document.getElementById('data-loader');
            const errorDiv = document.getElementById('loader-error');
            
            try {
                console.log('üì° –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...');
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
                const url = CONFIG.dataUrl + '&r=' + Math.random();
                console.log('URL:', url);
                
                const response = await fetch(url, {
                    cache: 'no-store',
                    headers: {
                        'Cache-Control': 'no-cache',
                        'Pragma': 'no-cache'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('üì¶ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã:', data);
                
                if (!data.events || !Array.isArray(data.events)) {
                    throw new Error('–ù–µ–≤–µ—Ä–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö: –Ω–µ—Ç –º–∞—Å—Å–∏–≤–∞ events');
                }
                
                allEvents = data.events;
                
                // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –æ–±—â–µ–µ —á–∏—Å–ª–æ –∏–∑ –∞—Ä—Ö–∏–≤–∞
                try {
                    const archiveResponse = await fetch(CONFIG.archiveUrl + '&r=' + Math.random(), {
                        cache: 'no-store'
                    });
                    if (archiveResponse.ok) {
                        const archiveData = await archiveResponse.json();
                        archivedTotal = archiveData.metadata?.totalEvents || archiveData.events?.length || allEvents.length;
                        console.log('üìö –í—Å–µ–≥–æ –≤ –∞—Ä—Ö–∏–≤–µ:', archivedTotal);
                    } else {
                        // –ï—Å–ª–∏ –∞—Ä—Ö–∏–≤–∞ –Ω–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º metadata –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Ñ–∞–π–ª–∞
                        archivedTotal = data.metadata?.archivedTotal || allEvents.length;
                    }
                } catch (e) {
                    archivedTotal = data.metadata?.archivedTotal || allEvents.length;
                    console.log('üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º archivedTotal –∏–∑ metadata:', archivedTotal);
                }
                
                dataLoaded = true;
                
                console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${allEvents.length} —Å–æ–±—ã—Ç–∏–π –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è`);
                console.log(`üìö –í—Å–µ–≥–æ –≤ –∞—Ä—Ö–∏–≤–µ: ${archivedTotal}`);
                
                // –ï—Å–ª–∏ splash screen —É–∂–µ –∑–∞–∫—Ä—ã—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å—Ä–∞–∑—É
                if (document.getElementById('splash-screen').classList.contains('hidden')) {
                    showData();
                }
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                errorDiv.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error.message + '. –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ...';
                errorDiv.style.display = 'block';
                
                // Fallback
                setTimeout(() => {
                    allEvents = getFallbackData();
                    archivedTotal = allEvents.length;
                    dataLoaded = true;
                    if (document.getElementById('splash-screen').classList.contains('hidden')) {
                        showData();
                    }
                }, 2000);
            }
        }

        function getFallbackData() {
            const today = new Date();
            return [
                {
                    date: today.toISOString().split('T')[0],
                    lat: 9.0810,
                    lng: 7.4895,
                    country: "–ù–∏–≥–µ—Ä–∏—è",
                    city: "–ê–±—É–¥–∂–∞",
                    type: "attack",
                    title: "‚ö†Ô∏è –¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ - –¥–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã",
                    description: "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å (F12) –∏ —Ñ–∞–π–ª data/events.json",
                    source: "Fallback",
                    url: "#",
                    victims: 5
                },
                {
                    date: new Date(today - 86400000).toISOString().split('T')[0],
                    lat: 20.9517,
                    lng: 85.0985,
                    country: "–ò–Ω–¥–∏—è",
                    city: "–û–¥–∏—à–∞",
                    type: "murder",
                    title: "–¢–µ—Å—Ç: –£–±–∏–π—Å—Ç–≤–æ —Ö—Ä–∏—Å—Ç–∏–∞–Ω",
                    description: "–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è",
                    source: "Fallback",
                    url: "#",
                    victims: 3
                }
            ];
        }

        function enterSite() {
            const splash = document.getElementById('splash-screen');
            const mainApp = document.getElementById('main-app');
            const loader = document.getElementById('data-loader');
            
            splash.classList.add('hidden');
            mainApp.classList.add('visible');
            
            // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Ö
            if (dataLoaded) {
                showData();
                loader.classList.add('hidden');
            } else {
                // –ñ–¥—ë–º –∑–∞–≥—Ä—É–∑–∫–∏
                const checkInterval = setInterval(() => {
                    if (dataLoaded) {
                        clearInterval(checkInterval);
                        showData();
                        loader.classList.add('hidden');
                    }
                }, 100);
                
                // –¢–∞–π–º–∞—É—Ç 10 —Å–µ–∫—É–Ω–¥
                setTimeout(() => {
                    clearInterval(checkInterval);
                    if (!dataLoaded) {
                        loader.classList.add('hidden');
                        alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
                    }
                }, 10000);
            }
        }

        function showData() {
            console.log('üìä –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ:', allEvents.length, '—Å–æ–±—ã—Ç–∏–π');
            renderEvents(allEvents);
            updateStats(allEvents);
        }

        function renderEvents(events) {
            // –û—á–∏—â–∞–µ–º –º–∞—Ä–∫–µ—Ä—ã
            markers.forEach(m => map.removeLayer(m));
            markers = [];
            
            const listContainer = document.getElementById('events-list');
            listContainer.innerHTML = '';

            if (events.length === 0) {
                listContainer.innerHTML = '<div style="padding: 20px; text-align: center; color: #888;">–ù–µ—Ç —Å–æ–±—ã—Ç–∏–π</div>';
                return;
            }

            events.forEach(event => {
                const color = CONFIG.colors[event.type] || CONFIG.colors.other;
                
                // –ú–∞—Ä–∫–µ—Ä –Ω–∞ –∫–∞—Ä—Ç–µ
                const marker = L.circleMarker([event.lat, event.lng], {
                    radius: event.victims > 10 ? 10 : (event.victims > 0 ? 7 : 5),
                    fillColor: color,
                    color: '#fff',
                    weight: 2,
                    fillOpacity: 0.8
                }).addTo(map);

                marker.bindPopup(`
                    <div style="min-width: 250px; font-family: sans-serif;">
                        <h3 style="color: ${color}; margin: 0 0 10px 0;">${event.title}</h3>
                        <p><strong>üìÖ</strong> ${new Date(event.date).toLocaleDateString('ru-RU')}</p>
                        <p><strong>üìç</strong> ${event.city}, ${event.country}</p>
                        <p><strong>üè∑Ô∏è</strong> ${CONFIG.typeLabels[event.type] || event.type}</p>
                        ${event.victims > 0 ? `<p><strong>üíÄ</strong> ${event.victims} –∂–µ—Ä—Ç–≤</p>` : ''}
                        <p style="font-size: 0.85em; color: #666; margin-top: 10px;">${event.description || ''}</p>
                        <p style="font-size: 0.75em; color: #888;">–ò—Å—Ç–æ—á–Ω–∏–∫: ${event.source}</p>
                    </div>
                `);
                
                markers.push(marker);

                // –ö–∞—Ä—Ç–æ—á–∫–∞ –≤ —Å–ø–∏—Å–∫–µ
                const card = document.createElement('div');
                card.className = 'event-card';
                card.style.setProperty('--color', color);
                card.innerHTML = `
                    <div class="event-date">${new Date(event.date).toLocaleDateString('ru-RU')} ‚Ä¢ ${CONFIG.typeLabels[event.type] || event.type}</div>
                    <div class="event-title">${event.title}</div>
                    <div class="event-location">üìç ${event.city}, ${event.country}</div>
                `;
                card.onclick = () => {
                    map.setView([event.lat, event.lng], 8);
                    marker.openPopup();
                };
                listContainer.appendChild(card);
            });
        }

        function filterEvents(type) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if ((type === 'all' && btn.textContent === '–í—Å–µ') || 
                    btn.textContent === CONFIG.typeLabels[type]) {
                    btn.classList.add('active');
                }
            });
            
            const filtered = type === 'all' ? allEvents : allEvents.filter(e => e.type === type);
            renderEvents(filtered);
            updateStats(filtered);
        }

        function updateStats(events) {
            document.getElementById('total-events').textContent = events.length;
            document.getElementById('total-countries').textContent = new Set(events.map(e => e.country)).size;
            document.getElementById('total-victims').textContent = events.reduce((sum, e) => sum + (e.victims || 0), 0);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞ –≥–æ–¥ –∏–∑ –∞—Ä—Ö–∏–≤–∞
            const archivedEl = document.getElementById('archived-total');
            if (archivedEl) {
                archivedEl.textContent = archivedTotal || events.length;
            }
        }
    </script>
</body>
</html>
